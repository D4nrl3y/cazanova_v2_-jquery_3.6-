function toReal(t,a){return a+Number(t).formatMoney(2,",",".")}Number.prototype.formatMoney=function(t,a,r){var e=this,i=(t=isNaN(t=Math.abs(t))?2:t,a=null==a?".":a,r=null==r?",":r,e<0?"-":""),d=parseInt(e=Math.abs(+e||0).toFixed(t))+"",n=(n=d.length)>3?n%3:0;return i+(n?d.substr(0,n)+r:"")+d.substr(n).replace(/(d{3})(?=d)/g,"$1"+r)+(t?a+Math.abs(e-d).toFixed(t).slice(2):"")};var cart={session:function(){return jQuery("html").attr("data-session")},idStore:function(){return jQuery("html").attr("data-store")},removeProduct:function(t){var a=parseInt(jQuery(t).attr("data-id")),r="/"+jQuery(t).attr("data-variant"),e=""==jQuery(t).attr("data-add")?"":"/?additional_information="+jQuery(t).attr("data-add").replace(/br>/g,"br/>"),i=""!==jQuery(t).attr("data-together")?"/"+jQuery(t).attr("data-together"):"";jQuery.ajax({method:"DELETE",url:"/web_api/carts/"+cart.session()+"/"+a+r+i+e}).done(function(t){cart.listProduct()}).fail(function(t){cart.listProduct()})},addQnt:function(t,a){this.refreshQnt(t,{cart_id:a.cart_id,quantity:a.quantity,product_id:a.product_id,variant_id:a.variant_id})},refreshQnt:function(t,a){var r,e="/checkout/cart/api/item/"+a.cart_id+"?session_id="+this.session()+"&store_id="+this.idStore()+"&zip_code=null";if("decrement"==jQuery(t).attr("data-js")){if(1==a.quantity)return;a.quantity>1&&(1==a.quantity&&$(t).addClass("disabled"),r=a.quantity-1)}if("increment"==jQuery(t).attr("data-js")){if(jQuery(t).hasClass("disabled"))return;r=a.quantity+1}void 0!==a.manually&&a.manually&&(r=a.quantity),jQuery.ajax({method:"PUT",url:e,contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:jQuery.param({quantity:r,product_id:a.product_id,variant_id:a.variant_id}),success:function(){cart.listProduct()}})},listProduct:function(){jQuery(".cart-modal .list").html('<div class="load-css"></div>'),jQuery(".cart-modal").removeClass("load"),jQuery.ajax({method:"GET",url:"/checkout/cart/api?session_id="+cart.session()+"&store_id="+cart.idStore()+"&nocache=0."+(new Date).getTime(),success:function(t){var a=t.data.cart.products,r=[];a.forEach(function(t){r.push({Cart:{email:"",variants_kit:t.variants_kit||"",additional_info_kit:t.additional_info_kit||"",price_itens_kit:t.price_itens_kit||"",product_id:t.id,product_name:t.name,quantity:t.quantity,price:t.price,variant_id:t.variant_id||"0",additional_information:t.additional_information,product_url:t.url,bought_together_id:t.bought_together_id||"",product_image:t.images,cart_id:t.cart_id,stock:t.stock}})}),cart.forProduct(r)},error:function(){cart.forProduct([])}})},number:function(t){jQuery('[data-cart="amount"]').text(t)},total:function(t){this.shipping(t),jQuery('[data-cart="price"]').text(toReal(parseFloat(t),"")),jQuery('[data-js="price"]').text(toReal(parseFloat(t),"R$ "))},forProduct:function(t){var a=jQuery(".cart-modal .list");a.find("*").remove(),a.parent().removeClass("empty"),a.parent().addClass("load"),jQuery(".modal-theme").removeClass("active"),jQuery(".cart-header").addClass("active");var r=jQuery(".botao-commerce.buy"),e=r.attr("href")+"/checkout?session_id="+cart.session()+"&store_id="+cart.idStore();r.attr("href",e);var i=0,d=0,n=[];t.length?(t.forEach(function(t){var r=(t=t.Cart).additional_information.replace(/\//g,"");prices=t,a.append(cart.templateProduct(t.product_id,t.variant_id,t.product_name,t.product_image.medium,t.quantity,t.price,t.product_url.https,r,t.additional_info_kit,t.bought_together_id,t.cart_id,t.stock)),i+=parseInt(t.quantity),d+=parseFloat(t.price)*parseInt(t.quantity),n.push(parseInt(t.product_id))}),cart.number(i),cart.total(d)):(a.append('<div class="empty-area"><div class="area-icon"></div><span class="featured">Carrinho de compras vazio</span><span class="msg">Nenhum item foi adicionado ainda.</span></div>'),a.parent().addClass("empty"),a.parent().removeClass("load"),cart.number(0),cart.total(0),jQuery("body").find(".add-cart .buy-product").each(function(){jQuery(this).hasClass("active")&&jQuery(this).removeClass("active").find(".text").text("Comprar")}))},startCart:function(){jQuery('[data-js="open_cart"]').on("click",function(){cart.showCart()}),jQuery(".product-submit").on("submit",function(t){t.preventDefault();var a=jQuery(this).find(".select").val(),r=jQuery(this).find(".quantity").val(),e=jQuery(this).find(".quantity").attr("data-id");a&&cart.addVariantComplete(a,r,e)}),jQuery(".cart-modal .close-button, .cart-modal .continue-buying").on("click",function(){jQuery(".shadow-top,.cart-modal").toggleClass("active")}),jQuery(".remove-items").on("click",function(){cart.removeCart()})},removeCart:function(){jQuery.ajax({method:"DELETE",url:"/web_api/carts/"+cart.session()}).done(function(t){cart.listProduct()}).fail(function(t){cart.listProduct()})},showCart:function(){jQuery(".shadow-top,.cart-modal").toggleClass("active"),cart.listProduct()},templateProduct:function(t,a,r,e,i,d,n,o,c,s,u,l){var p="{        'cart_id': "+u+",        'quantity': "+i+",        'product_id': "+t+",        'variant_id': "+a+"        }",m='        <div class="item flex">            <a href="{url}"><img src="{image}" alt="{name}"></a>            <div class="info">                <span class="name">{name}</span>                <div class="line-footer">                    <span class="price">{price}</span>                    <div class="qnt">                        <input data-js="qnt" type="number" value="{length}" min="1" max="{stock}" data-cart-id="{cart_id}" data-id="{id}" data-variant="{variant}" />                        <div data-js="decrement" tabindex="0" role="button" data-stock="{stock}" data-together="{together}" data-id="{id}" data-variant="{variant}" data-add="{addMsg}" onclick="cart.addQnt(this,'+p+')" class="{disableDec}"></div>                        <div data-js="increment" tabindex="0" role="button" data-stock="{stock}" data-together="{together}" data-id="{id}" data-variant="{variant}" data-add="{addMsg}" onclick="cart.addQnt(this,'+p+')" class="{disable}"></div>                    </div>                    <div class="remove" data-id="{id}" data-variant="{variant}" data-add="{addMsg}" onclick="cart.removeProduct(this)">                        <span class="ic-trash"></span>                    </div>                </div>            </div>        </div>        ';return m=(m=(m=(m=(m=(m=(m=(m=(m=(m=(m=(m=m.replace(/{url}/g,n)).replace(/{image}/g,e)).replace(/{name}/g,r)).replace(/{id}/g,t)).replace(/{variant}/g,0!=a?a:"0")).replace(/{length}/g,i)).replace(/{addMsg}/g,o)).replace(/{together}/g,s)).replace(/{stock}/g,l)).replace(/{cart_id}/g,u)).replace(/{disable}/g,l==i?"disabled":"")).replace(/{disableDec}/g,1==i?"disabled":""),d=toReal(parseFloat(d),"R$ "),m=m.replace(/{price}/g,d)},shipping:function(t){var a=jQuery(".cart-modal .shipping");if(a.length){var r=Number(a.attr("data-value")),e=jQuery('[data-js="shipping-decrement"]'),i=jQuery(".bar-progress"),d=jQuery(".bar-progress .bar"),n=r-t;if(t)if(n>0){o="Faltam <b>"+toReal(n,"R$ ")+"</b> para você ganhar frete grátis.";e.html(o),i.attr("data-value",(t/r*100).toFixed(0)+"%"),d.attr("style","width: "+t/r*100+"%")}else e.html("<b>PARABÉNS!</b> Você desbloqueou o frete grátis!"),i.attr("data-value","100%"),d.attr("style","width: 100%");else{var o="Frete grátis nas compras acima de <b>"+toReal(r,"R$ ")+"</b>*";e.html(o),i.attr("data-value","0%"),d.attr("style","width: 0%")}}},addProduct:function(){jQuery("body").on("submit",".product .submit",function(t){var a=jQuery(this);t.preventDefault();var r=jQuery(this).data("config"),e={Cart:{session_id:cart.session(),product_id:r.id,quantity:1,variant_id:"0"}};jQuery.ajax({method:"POST",url:"/web_api/cart/",contentType:"application/json; charset=utf-8",data:JSON.stringify(e),success:function(t){jQuery('[data-js="open_cart"]').trigger("click")},error:function(){window.location.href=a.parents(".product").find(".image").attr("href")}})}),jQuery("body").on("change input",'[data-js="qnt"]',function(){var t,a=Number(jQuery(this).val()),r=$(this);a?jQuery(this).val(a):jQuery(this).val("1"),Number(r.val())>Number(r.attr("max"))&&r.val(Number(r.attr("max"))),clearTimeout(t),t=setTimeout(function(){cart.refreshQnt(r,{cart_id:r.data("cart-id"),quantity:a,product_id:r.data("id"),variant_id:r.data("variant"),manually:!0})},2500)})},qntProduct:function(){jQuery("body").on("click",'.product [data-js="decrement"]',function(){var t=jQuery(this).parent().find("input");t.val(1==parseInt(t.val())?1:parseInt(t.val())-1),1==t.val()?jQuery(this).addClass("dec"):jQuery(this).removeClass("dec")}),jQuery("body").on("click",'.product [data-js="increment"]',function(){var t=jQuery(this).parent().find("input");if(Number(t.attr("data-max"))>t.val()||!t.attr("data-max")){var a=parseInt(t.val())+1;t.val(a),jQuery(this).parent().find('[data-js="decrement"]').removeClass("dec")}})}};cart.startCart(),cart.addProduct(),cart.qntProduct();